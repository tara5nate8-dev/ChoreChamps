
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ChoreChamps</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style> body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; } </style>
  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-50">

<main class="max-w-5xl mx-auto p-6 space-y-6">
  <header class="flex items-center justify-between">
    <h1 class="text-3xl font-extrabold">üèÜ Liam‚Äôs Dashboard</h1>
    <nav class="space-x-2">
      <a class="px-3 py-2 bg-white shadow rounded-xl border" href="index.html">Home</a>
      <a class="px-3 py-2 bg-white shadow rounded-xl border" href="maggie.html">Maggie</a>
      <a class="px-3 py-2 bg-white shadow rounded-xl border" href="parent.html">Parent</a>
    </nav>
  </header>

  <section class="bg-white rounded-2xl border shadow p-5">
    <div id="summary" class="text-lg"></div>
  </section>

  <section id="personal" class="bg-white rounded-2xl border shadow p-5"></section>
  <section id="shared"   class="bg-white rounded-2xl border shadow p-5"></section>
</main>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDGzTazPvOiEhTDPg5jyIO17pfv9lCM3OI",
  authDomain: "chore-chart-2.firebaseapp.com",
  databaseURL: "https://parsell-family-chore-chart-default-rtdb.firebaseio.com",
  projectId: "chore-chart-2",
  storageBucket: "chore-chart-2.appspot.com",
  messagingSenderId: "881327854483",
  appId: "1:881327854483:web:b6f10033c0840a1ccb8e66"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const DAYS = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
function prettyName(base){ return base.replace(/([A-Z])/g, m=>' '+m).trim(); }
</script>

<script>
const CHILD = 'liam';
const OTHER = CHILD==='liam' ? 'maggie' : 'liam';

const REQUIRED_PERSONAL = 10;
const REQUIRED_SHARED   = 5;

let chores = {};

function splitChoresFor(child){
  const mine = Object.entries(chores)
    .filter(([k]) => k.startsWith(child))
    .map(([k,v]) => {
      const base = k.replace(/^liam|^maggie/,'');
      const shared = !!chores[(child==='liam'?'maggie':'liam') + base];
      return { key:k, base, value:v, shared };
    });
  return {
    personal: mine.filter(c=>!c.shared),
    shared:   mine.filter(c=> c.shared)
  };
}

function countDone(list){ return list.reduce((s,c)=> s + (Array.isArray(c.value) ? c.value.filter(Boolean).length : (c.value?1:0)), 0); }

function headings(items){ 
  const anyArray = items.some(i => Array.isArray(i.value));
  return anyArray ? DAYS.map(d=>`<th>${d}</th>`).join('') + `<th>‚úîÔ∏é/wk</th>` : `<th>This week</th><th>‚úîÔ∏é</th>`;
}

function row(item){ 
  const name = prettyName(item.base);
  if (Array.isArray(item.value)) { 
    const cells = item.value.map((v,idx)=>`<td class="text-center">
      <button class="px-2 py-1 ${v?'bg-green-600 text-white':'bg-gray-200'} rounded" onclick="toggleArray('${item.key}',${idx})">${v?'‚úì':''}</button>
    </td>`).join('');
    const weekly = item.value.filter(Boolean).length;
    return `<tr class="border-b"><td>${name}</td>${cells}<td class="text-center">${weekly}</td></tr>`;
  } else {
    return `<tr class="border-b"><td>${name}</td>
      <td class="text-center"><button class="px-2 py-1 ${item.value?'bg-green-600 text-white':'bg-gray-200'} rounded" onclick="toggleBool('${item.key}')">${item.value?'‚úì':''}</button></td>
      <td class="text-center">${item.value?1:0}</td>
    </tr>`;
  }
}

function tableBlock(title, items){ 
  if (!items.length) return `<h2 class="text-xl font-semibold mb-2">${title}</h2><p class="text-gray-500">No tasks yet.</p>`;
  const rows = items.map(row).join('');
  return `<h2 class="text-xl font-semibold mb-2">${title}</h2>
    <table class="min-w-full text-sm">
      <thead class="bg-gray-50"><tr><th class="text-left">Chore</th>${headings(items)}</tr></thead>
      <tbody>${rows}</tbody>
    </table>`;
}

function render(){
  const { personal, shared } = splitChoresFor(CHILD);
  const pDone = countDone(personal), sDone = countDone(shared);
  document.getElementById('summary').innerHTML =
    `Personal: <b>${pDone}</b> / ${REQUIRED_PERSONAL} &nbsp;‚Ä¢&nbsp; Shared: <b>${sDone}</b> / ${REQUIRED_SHARED}`;

  document.getElementById('personal').innerHTML = tableBlock('My Personal Tasks', personal);
  document.getElementById('shared').innerHTML   = tableBlock('Shared Tasks', shared);
}

window.toggleArray = async (key, idx) => { 
  const path = `choreData/chores/${key}`;
  const snap = await db.ref(path).get();
  const arr = snap.val() || Array(7).fill(false);
  arr[idx] = !arr[idx];
  await db.ref(path).set(arr);
};
window.toggleBool = async (key) => { 
  const path = `choreData/chores/${key}`;
  const snap = await db.ref(path).get();
  const val = !!snap.val();
  await db.ref(path).set(!val);
};

db.ref('choreData/chores').on('value', s => { chores = s.val()||{}; render(); });
</script>
</body></html>
